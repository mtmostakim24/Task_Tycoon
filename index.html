<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Tycoon - Ultimate Fix</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; }
        .card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .btn { background: #4CAF50; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; margin-top: 10px; cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; }
        .notification { position: fixed; top: 20px; right: 20px; background: #4CAF50; padding: 15px; border-radius: 8px; z-index: 1000; }
    </style>
</head>
<body>
    <div class="container">
        <!-- SIMPLE ONE PAGE SOLUTION -->
        <div class="card">
            <h2>ðŸ’° Task Tycoon</h2>
            
            <!-- User 1 Section -->
            <div id="user1Section">
                <h3>ðŸ‘¤ User 1 (Referrer)</h3>
                <input type="text" id="user1Name" placeholder="Your Name" value="John">
                <input type="tel" id="user1Mobile" placeholder="Mobile" value="01711111111">
                <button class="btn" onclick="createUser1()">Create User 1</button>
            </div>

            <!-- User 2 Section -->
            <div id="user2Section" style="display: none; margin-top: 20px; border-top: 1px solid white; padding-top: 20px;">
                <h3>ðŸ‘¤ User 2 (Referred)</h3>
                <input type="text" id="user2Name" placeholder="Friend's Name" value="Mike">
                <input type="tel" id="user2Mobile" placeholder="Mobile" value="01722222222">
                <p>Referral Code: <strong id="displayReferralCode"></strong></p>
                <button class="btn" onclick="createUser2()">Create User 2 with Referral</button>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" style="display: none; margin-top: 20px; border-top: 1px solid white; padding-top: 20px;">
                <h3>ðŸ“Š Results</h3>
                <div id="user1Info"></div>
                <div id="user2Info"></div>
                <div id="referralResult"></div>
                
                <button class="btn" onclick="user2EarnMoney()" style="background: #2196F3;">User 2 Earn $0.50</button>
                <button class="btn" onclick="checkReferralBonus()" style="background: #FF9800;">Check Referral Bonus</button>
                <button class="btn" onclick="resetAll()" style="background: #f44336;">Reset & Test Again</button>
            </div>
        </div>
    </div>

    <script>
        // SIMPLE GLOBAL VARIABLES
        let user1 = null;
        let user2 = null;
        let referralCode = '';

        function createUser1() {
            const name = document.getElementById('user1Name').value;
            const mobile = document.getElementById('user1Mobile').value;
            
            if (!name || !mobile) {
                alert('Please fill all fields');
                return;
            }

            // Create User 1
            user1 = {
                id: 1,
                name: name,
                mobile: mobile,
                balance: 0,
                referralCode: 'REF' + Math.random().toString(36).substring(2, 6).toUpperCase(),
                referrals: []
            };

            referralCode = user1.referralCode;
            
            // Show User 2 section
            document.getElementById('user2Section').style.display = 'block';
            document.getElementById('displayReferralCode').textContent = referralCode;
            
            alert('âœ… User 1 created! Referral Code: ' + referralCode);
        }

        function createUser2() {
            const name = document.getElementById('user2Name').value;
            const mobile = document.getElementById('user2Mobile').value;
            
            if (!name || !mobile) {
                alert('Please fill all fields');
                return;
            }

            if (!user1) {
                alert('Please create User 1 first');
                return;
            }

            // Create User 2 with referral
            user2 = {
                id: 2,
                name: name,
                mobile: mobile,
                balance: 0,
                referredBy: user1.referralCode
            };

            // ðŸ”¥ ADD TO USER 1's REFERRALS
            user1.referrals.push({
                id: user2.id,
                name: user2.name,
                earned: 0,
                status: 'pending'
            });

            // Show results
            document.getElementById('resultsSection').style.display = 'block';
            updateResults();
            
            alert('ðŸŽ‰ User 2 created with referral! Referral added to User 1.');
        }

        function user2EarnMoney() {
            if (!user2) {
                alert('Please create User 2 first');
                return;
            }

            // User 2 earns money
            user2.balance += 0.50;
            
            // ðŸ”¥ UPDATE REFERRAL PROGRESS
            const referral = user1.referrals.find(ref => ref.id === user2.id);
            if (referral) {
                referral.earned += 0.50;
                
                // Check if reached $15 for bonus
                if (referral.earned >= 15 && referral.status === 'pending') {
                    referral.status = 'active';
                    user1.balance += 1.00; // $1 bonus
                    alert('ðŸŽŠ REFERRAL BONUS! User 1 got $1.00 bonus!');
                }
            }

            updateResults();
            alert('âœ… User 2 earned $0.50! Referral progress updated.');
        }

        function checkReferralBonus() {
            if (!user1 || !user2) {
                alert('Please create both users first');
                return;
            }

            const referral = user1.referrals.find(ref => ref.id === user2.id);
            if (referral) {
                const needed = (15 - referral.earned).toFixed(2);
                alert(`ðŸ“Š Referral Progress:\nEarned: $${referral.earned.toFixed(2)}\nNeeded: $${needed} more for bonus\nStatus: ${referral.status}`);
            }
        }

        function updateResults() {
            // Update User 1 Info
            document.getElementById('user1Info').innerHTML = `
                <h4>User 1 (${user1.name})</h4>
                <p>Balance: $${user1.balance.toFixed(2)}</p>
                <p>Referrals: ${user1.referrals.length}</p>
            `;

            // Update User 2 Info  
            document.getElementById('user2Info').innerHTML = `
                <h4>User 2 (${user2.name})</h4>
                <p>Balance: $${user2.balance.toFixed(2)}</p>
                <p>Referred by: ${user2.referredBy}</p>
            `;

            // Update Referral Results
            const referral = user1.referrals.find(ref => ref.id === user2.id);
            if (referral) {
                document.getElementById('referralResult').innerHTML = `
                    <h4>ðŸŽ¯ Referral Status</h4>
                    <p>Referred User: ${referral.name}</p>
                    <p>Earned: $${referral.earned.toFixed(2)} / $15.00</p>
                    <p>Progress: ${((referral.earned / 15) * 100).toFixed(1)}%</p>
                    <p>Status: <strong style="color: ${referral.status === 'active' ? '#4CAF50' : '#FF9800'}">${referral.status.toUpperCase()}</strong></p>
                `;
            }
        }

        function resetAll() {
            user1 = null;
            user2 = null;
            referralCode = '';
            
            document.getElementById('user2Section').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('user1Name').value = 'John';
            document.getElementById('user1Mobile').value = '01711111111';
            document.getElementById('user2Name').value = 'Mike'; 
            document.getElementById('user2Mobile').value = '01722222222';
            
            alert('ðŸ”„ Reset complete! You can test again.');
        }

        // Initialize with demo data
        window.onload = function() {
            alert('ðŸš€ Welcome! This is the ULTIMATE referral test.\n\nClick "Create User 1" to start.');
        };
    </script>
</body>
</html>
